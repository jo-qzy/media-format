CMAKE_MINIMUM_REQUIRED(VERSION 3.13)

PROJECT(flv)

FILE(GLOB include/*.h HEADERS)

INCLUDE_DIRECTORIES(include)

# Build LIBFLV
AUX_SOURCE_DIRECTORY(src SOURCE_FILES)

ADD_LIBRARY(LIBFLV STATIC ${SOURCE_FILES})
SET_TARGET_PROPERTIES(LIBFLV PROPERTIES OUTPUT_NAME ${PROJECT_NAME})

ADD_LIBRARY(LIBFLV_SHARED SHARED ${SOURCE_FILES})
SET_TARGET_PROPERTIES(LIBFLV_SHARED PROPERTIES OUTPUT_NAME ${PROJECT_NAME})

# Build test
IF (BUILD_TEST)
    AUX_SOURCE_DIRECTORY(test TEST_SOURCE_FILES)

    FOREACH(TEST_FILE ${TEST_SOURCE_FILES})
        GET_FILENAME_COMPONENT(TEST_BIN ${TEST_FILE} NAME_WE)

        ADD_EXECUTABLE(${TEST_BIN} ${TEST_FILE})
        TARGET_LINK_LIBRARIES(${TEST_BIN} LIBFLV)

        INSTALL(TARGETS ${TEST_BIN} DESTINATION ${PROJECT_SOURCE_DIR}/bin)
        ADD_TEST(NAME ${TEST_BIN} COMMAND ${TEST_BIN})
    ENDFOREACH()
ENDIF()

# Install library and binary
INSTALL(TARGETS LIBFLV LIBFLV_SHARED
        ARCHIVE DESTINATION ${CMAKE_INSTALL_PREFIX}/lib
        LIBRARY DESTINATION ${CMAKE_INSTALL_PREFIX}/lib)

INSTALL(FILES ${HEADERS} DESTINATION ${CMAKE_INSTALL_PREFIX}/LIBFLV/include)
